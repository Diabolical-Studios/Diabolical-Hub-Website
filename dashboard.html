<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Upload Game</title>
    <link rel="icon" href="favicon.png" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/card.css" rel="stylesheet" />
    <script defer="defer" src="cards.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

    <meta name="theme-color" content="#222222" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <style>
      #upload-form {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 8px;
        padding: 20px;
        width: 50vw;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
        transition: transform 0.2s;
      }

      @media (max-width: 1200px) {
        #upload-form {
          background-color: rgba(255, 255, 255, 0.1);
          border-radius: 8px;
          padding: 20px;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
          transition: transform 0.2s;
          width: 90vw;
          overflow: auto;
          height: 70svh;
        }
      }

      #upload-form:hover {
        transform: translateY(-3px);
      }

      #upload-form label {
        font-weight: 400;
        margin-bottom: 5px;
        color: #ffffff;
        display: block;
      }

      #upload-form input[type="text"],
      #upload-form input[type="url"],
      #upload-form textarea,
      #upload-form input[type="file"] {
        width: 100%;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 4px;
        border: 1px solid #ccc;
        background-color: rgba(255, 255, 255, 0.2);
        color: #e3b40c;
        font-size: 16px;
      }

      #upload-form input[type="submit"] {
        background-color: #008cba;
        color: rgb(255, 255, 255);
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        transition: background-color 0.2s;
      }

      #upload-form input[type="submit"]:hover {
        background-color: #005f5f;
      }

      #upload-form select {
        width: 100%;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 4px;
        border: 1px solid #ccc;
        background-color: rgba(255, 255, 255, 0.2);
        color: #e3b40c;
        font-size: 16px;
      }

      #upload-form option {
        background-color: #333;
        color: #e3b40c;
      }

      .hero__title {
        transition: color 0.2s;
      }

      .hero__title:hover {
        color: #e3b40c;
      }

      textarea {
        resize: vertical;
      }

      /* Add your toast styles here */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 999999;
      }

      .toast-notification {
        background-color: #333;
        color: white;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 5px;
        opacity: 0;
        transition: opacity 0.5s, transform 0.5s;
        transform: translateY(-100px);
        display: none;
        width: 250px;
      }

      .toast-show {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }

      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
    </style>
  </head>

  <body
    class="w-screen h-screen bg-black bg-radial bg-[position:0_0] bg-20px text-white font-mono overflow-hidden animate-moveBackground select-none"
  >
    <div class="flex gap-6">
      <div class="flex-1 w-2/4">
        <h1 class="text-2xl font-bold text-yellow-400 mb-4">Create Team</h1>
        <form
          id="createTeamForm"
          onsubmit="createTeam(event)"
          class="space-y-4"
          style="
            width: fit-content;
            display: flex;
            flex-direction: column;
            gap: 12px;
          "
        >
          <input
            type="text"
            name="team_name"
            placeholder="Team Name"
            required
          />

          <!-- Submit Button -->
          <button
            type="submit"
            class="w-full py-2 bg-yellow-500 text-gray-800 font-bold rounded hover:bg-yellow-400"
          >
            Submit
          </button>
        </form>
      </div>

      <div class="flex-1">
        <h1 class="text-2xl font-bold text-yellow-400 mb-4">Upload Game</h1>
        <form
          id="uploadGameForm"
          onsubmit="uploadGame(event)"
          class="space-y-4"
          style="display: flex; flex-direction: column; gap: 12px"
        >
          <input
            type="text"
            name="game_name"
            placeholder="Game Name"
            required
          />
          <input
            type="text"
            name="team_name"
            placeholder="Team Name"
            required
          />
          <input type="text" name="description" placeholder="Description" />
          <input type="text" name="team_icon_url" placeholder="Icon URL" />
          <input
            type="text"
            name="background_image_url"
            placeholder="Banner URL"
          />
          <input type="text" name="version" placeholder="Version" required />
          <button type="submit">Upload Game</button>
        </form>
      </div>
    </div>

    <script>
      async function createTeam(event) {
        event.preventDefault();

        console.log("Starting createTeam process...");

        // Get the team name from the form
        const teamName = event.target.teamName.value;
        console.log("Team name provided:", teamName);

        // Fetch the session or user ID (replace with actual logic if stored in cookies or localStorage)
        const userId = getUserIdFromSession(); // Define this function below to fetch the user_id
        console.log("User ID fetched:", userId);

        if (!userId) {
          alert("User is not logged in. Unable to create team.");
          console.error("Error: Missing user ID");
          return;
        }

        try {
          // Call the Netlify serverless function
          const response = await fetch("/.netlify/functions/createTeam", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ team_name: teamName, user_id: userId }),
          });

          console.log("Response received from createTeam function:", response);

          const data = await response.json();
          console.log("Response data:", data);

          if (response.ok) {
            alert("Team created successfully");
            console.log("Team created successfully with ID:", data.team_id);
          } else {
            alert(`Error: ${data.error}`);
            console.error("Error response from API:", data.error);
          }
        } catch (error) {
          console.error("Error occurred while creating the team:", error);
          alert(`Error: ${error.message}`);
        }
      }

      // Helper function to fetch the user ID from cookies or localStorage
      function getUserIdFromSession() {
        const sessionCookie = document.cookie
          .split("; ")
          .find((row) => row.startsWith("sessionID="));

        if (!sessionCookie) {
          console.warn("No session cookie found");
          return null;
        }

        // Placeholder for your actual logic to extract user ID from the session or API
        // For now, you can return a hardcoded user ID for testing
        console.log("Session cookie:", sessionCookie);
        return 1; // Replace with actual logic to get user ID
      }
    </script>

    <script>
      async function uploadGame(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const response = await fetch("/.netlify/functions/uploadGame", {
          method: "POST",
          body: JSON.stringify(Object.fromEntries(formData)),
        });

        const data = await response.json();
        if (response.ok) {
          alert("Game uploaded successfully");
        } else {
          alert(`Error: ${data.error}`);
        }
      }
    </script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </body>
</html>
